<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LOOKERIN • Mini Job Portal</title>
  <meta name="description" content="LOOKERIN – by SIMGROUP. Mini job portal dengan filter Area & Job Parent (dependent), tampilan mobile & web, kartu kapsul, popup detail + Apply. Versi ini fokus pada: load data sempurna (CSV/JSON robust), cepat (cache + pager), dan fallback andal."/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#1BAFBF;           /* turquoise */
      --brand-ink:#0d5c66;       /* darker turquoise */
      --ink:#0f172a;             /* slate-900 */
      --muted:#f1f5f9;           /* slate-100 */
      --line:#e2e8f0;            /* slate-200 */
      --bg:#ffffff;
      --card:#ffffff;
      --shadow:0 6px 20px rgba(0,0,0,.06);
      --radius:18px;
      --sticky-top: 0px;         /* diisi JS = tinggi header */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--ink); background:var(--bg)}
    .wrap{max-width:1100px;margin:0 auto;padding:20px 16px 80px}

    /* Header */
    header{position:sticky;top:0;z-index:30;background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.92));backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid var(--line)}
    .head-inner{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;align-items:center;gap:14px}
    .logo{width:42px;height:42px;border-radius:12px;background:conic-gradient(from 120deg,#76e4ef,#22d3ee,#0ea5b8,#0891b2,#76e4ef);display:grid;place-items:center;box-shadow:var(--shadow)}
    .logo::before{content:"";width:18px;height:18px;border:3px solid #fff;border-radius:50%;box-shadow:0 0 0 3px rgba(255,255,255,.35)}
    .title{display:flex;flex-direction:column}
    .title h1{font-size:22px;line-height:1.1;margin:0;letter-spacing:.6px;font-weight:800;color:var(--brand-ink)}
    .title p{margin:2px 0 0;font-size:12px;color:#475569;font-weight:600}
    .hamburger{margin-left:auto;display:none;align-items:center;gap:8px;border:1px solid var(--line);background:#fff;border-radius:999px;padding:8px 12px;font-weight:800;cursor:pointer}
    .hamburger svg{width:18px;height:18px}

    /* Filter Bar (desktop & tablet) */
    .filters{position:sticky; top:calc(var(--sticky-top)); z-index:25; margin:18px 0 10px;background:var(--muted);border:1px solid var(--line);padding:12px;border-radius:16px;box-shadow:var(--shadow)}
    .filters .row{display:flex;flex-wrap:wrap;gap:10px}
    .fgrp{display:flex;align-items:center;gap:8px;background:#fff;border:1px solid var(--line);padding:8px 10px;border-radius:12px}
    .fgrp label{font-size:12px;color:#334155;font-weight:700}
    .fgrp select{appearance:auto;border:none;outline:none;font-size:13px;padding:6px 8px;background:#fff;color:#0f172a;min-width:220px}
    .f-actions{margin-left:auto;display:flex;gap:8px}
    .btn{border:none;outline:none;border-radius:999px;padding:10px 14px;font-weight:700;letter-spacing:.2px;cursor:pointer}
    .btn-primary{background:var(--brand);color:#00323a}
    .btn-ghost{background:#fff;color:#0f172a;border:1px solid var(--line)}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;min-height:40vh}
    @media (max-width:960px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:640px){
      .grid{grid-template-columns:1fr;gap:10px}
      .filters{display:none}
      .hamburger{display:inline-flex}
    }

    .card{position:relative;border:1px solid var(--line);background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px 14px;transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease}
    .card:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(0,0,0,.08);border-color:#bae6fd}

    /* Title + Parent with icons */
    .job-title,.job-parent{display:flex;align-items:center;gap:8px}
    .job-title{margin:2px 0 4px;font-size:12px;font-weight:800;color:#083344}
    .job-parent{font-size:10px;font-weight:600;color:#0b4c57;margin:2px 0 8px}
    .i{display:inline-flex;align-items:center;justify-content:center;line-height:0;color:var(--brand)}
    .job-title .i svg{width:16px;height:16px}
    .job-parent .i svg{width:14px;height:14px;opacity:.95}

    .loc{display:flex;align-items:center;gap:8px;font-size:12px;color:#0b3d44}
    .loc svg{width:16px;height:16px;flex:0 0 auto}
    .sal{display:flex;align-items:center;gap:8px;font-size:12px;color:#075e62;margin-top:6px}
    .sal svg{width:16px;height:16px;flex:0 0 auto}
    .show-more{margin-top:12px;border:1px solid var(--line);background:#fff;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:700;cursor:pointer}

    /* Pager */
    .pager{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:14px;position:sticky;bottom:0;background:linear-gradient(180deg,transparent, #fff 40%);padding:8px 0;z-index:10}
    .pager .btn{padding:8px 12px}
    .page-info{font:600 12px/1.4 Montserrat,system-ui}

    /* Empty / status */
    .status{padding:24px;text-align:center;color:#334155}

    /* Modal detail */
    dialog{width:min(700px, 94vw);border:none;border-radius:20px;padding:0;box-shadow:0 30px 80px rgba(0,0,0,.35)}
    .modal{padding:18px 18px 16px}
    .modal .title h2{font-size:20px;color:#062e33;margin:0}
    .modal .sub{margin:6px 0 10px;font-size:13px;color:#0b4c57;font-weight:700}
    .modal .meta{display:flex;align-items:center;gap:8px;color:#083344;font-size:13px}
    .modal .meta svg{width:18px;height:18px}
    .modal .qual{margin-top:14px;font-size:14px;line-height:1.5;color:#0f172a;background:var(--muted);padding:14px;border-radius:12px;border:1px solid var(--line);max-height:min(46vh,420px);overflow:auto}
    .modal .actions{margin-top:16px;display:flex;gap:10px;justify-content:flex-end}
    .x{position:absolute;top:8px;right:10px;border:none;background:transparent;font-size:22px;line-height:1;cursor:pointer;color:#0f172a}
    .apply-btn{display:inline-flex;align-items:center;gap:8px}
    .apply-btn svg{color:#d72638} /* merah untuk ikon Apply */
    .modal .sal-meta{color:#075e62}

    /* Dialog filter mobile */
    #dlg-filter::backdrop{background:rgba(0,0,0,.4)}
    #dlg-filter{width:min(520px,96vw);border:none;border-radius:16px;padding:0;overflow:hidden}
    .mfilter-hd{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line);background:#fff}
    .mfilter-bd{padding:14px;background:var(--muted)}
    .mfilter-row{display:flex;flex-direction:column;gap:8px}
    .mfilter-row .fgrp{width:100%}
    .mfilter-ft{display:flex;justify-content:flex-end;gap:8px;padding:12px 14px;border-top:1px solid var(--line);background:#fff}

    @media (prefers-reduced-motion: no-preference){
      @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
      .logo{animation:pulse 3s ease-in-out infinite}
    }
  </style>
</head>
<body>
  <header>
    <div class="head-inner">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">
        <h1>LOOKERIN</h1>
        <p>by SIMGROUP</p>
      </div>
      <button class="hamburger" id="btn-open-filter" type="button" aria-label="Buka Filter">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
        Filter
      </button>
    </div>
  </header>

  <div class="wrap">
    <!-- Filters (desktop & tablet) -->
    <section class="filters" aria-label="Filter Loker">
      <div class="row">
        <div class="fgrp">
          <label for="f-area">Area</label>
          <select id="f-area" title="Pilih Area (Kolom C)"></select>
        </div>
        <div class="fgrp">
          <label for="f-parent">Job Parent</label>
          <select id="f-parent" title="Pilih Job Parent (Kolom E)"></select>
        </div>
        <div class="f-actions">
          <button class="btn btn-ghost" id="btn-clear" type="button">Clear</button>
          <button class="btn btn-primary" id="btn-apply" type="button">Terapkan</button>
        </div>
      </div>
    </section>

    <!-- Grid / Results -->
    <div id="status" class="status" role="status" aria-live="polite" aria-busy="true">Mengambil data…</div>
    <section id="grid" class="grid" hidden></section>
    <div id="pager" class="pager" hidden>
      <button class="btn btn-ghost" id="pg-prev" type="button">◀︎ Sebelumnya</button>
      <span class="page-info" id="pg-info">-</span>
      <button class="btn btn-primary" id="pg-next" type="button">Berikutnya ▶︎</button>
    </div>
  </div>

  <!-- Modal Detail -->
  <dialog id="dlg">
    <div class="modal">
      <button class="x" id="dlg-x" aria-label="Tutup">×</button>
      <div class="title"><h2 id="dlg-job">-</h2></div>
      <div class="sub" id="dlg-parent">-</div>
      <div class="meta">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"/></svg>
        <span id="dlg-area">-</span>
      </div>
      <div class="meta sal-meta">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 7h18a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1Zm3 2v6m12-6v6"/><circle cx="12" cy="12" r="2.5"/></svg>
        <span id="dlg-salary">-</span>
      </div>
      <div class="qual" id="dlg-qual">-</div>
      <div class="actions">
        <a class="btn btn-primary apply-btn" id="dlg-apply" href="https://apply.career-simgroup.com" target="_blank" rel="noopener noreferrer" title="Apply di apply.career-simgroup.com">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M5 12h9M12 5l7 7-7 7"/></svg>
          Apply
        </a>
        <button class="btn btn-ghost" id="dlg-close" type="button">Tutup</button>
      </div>
    </div>
  </dialog>

  <!-- Dialog Filter Mobile -->
  <dialog id="dlg-filter">
    <div class="mfilter-hd">
      <strong>Filter</strong>
      <button class="btn btn-ghost" id="mf-close" type="button">Tutup</button>
    </div>
    <div class="mfilter-bd">
      <div class="mfilter-row">
        <div class="fgrp">
          <label for="mf-area">Area</label>
          <select id="mf-area"></select>
        </div>
        <div class="fgrp">
          <label for="mf-parent">Job Parent</label>
          <select id="mf-parent"></select>
        </div>
      </div>
    </div>
    <div class="mfilter-ft">
      <button class="btn btn-ghost" id="mf-clear" type="button">Clear</button>
      <button class="btn btn-primary" id="mf-apply" type="button">Terapkan</button>
    </div>
  </dialog>

  <!-- Debug overlay kecil (off by default) -->
  <div id="dbg" style="position:fixed;left:8px;bottom:8px;background:#00000099;color:#fff;padding:6px 8px;border-radius:8px;font:12px/1.3 ui-monospace,Menlo,monospace;z-index:9999;max-width:80vw;display:none"></div>

  <script>
  (function(){
    'use strict';
    // ====== CONFIG (Dokumen Data) ======
    const DOC_ID = '1ESGkZf2P_0XMnyJgb7wN_L_Xo144nO6GPg30rrBZW58';
    const SHEET  = 'Sheet1';

    // Endpoints (fallback berlapis)
    const GVIZ_JSON = `https://docs.google.com/spreadsheets/d/${DOC_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET)}`;
    const GVIZ_CSV  = `https://docs.google.com/spreadsheets/d/${DOC_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET)}`;
    const EXPORT_CSV = `https://docs.google.com/spreadsheets/d/${DOC_ID}/export?format=csv&sheet=${encodeURIComponent(SHEET)}`; // beberapa dokumen mendukung by-name
    const MIRROR = u => 'https://r.jina.ai/https/' + u.replace(/^https?:\/\//,'');

    // Kolom: C=Area, D=Nama Job, E=Job Parent, F=Kualifikasi, G=Salary
    const COL = { AREA:2, JOB_NAME:3, JOB_PARENT:4, QUAL:5, SALARY:6 };

    const CACHE_KEY = 'lookerin_cache_v8';

    // ====== Elemen ======
    const $grid = document.getElementById('grid');
    const $status = document.getElementById('status');
    const $pager = document.getElementById('pager');
    const $pgPrev = document.getElementById('pg-prev');
    const $pgNext = document.getElementById('pg-next');
    const $pgInfo = document.getElementById('pg-info');

    const $area = document.getElementById('f-area');
    const $parent = document.getElementById('f-parent');
    const $btnApply = document.getElementById('btn-apply');
    const $btnClear = document.getElementById('btn-clear');

    const $dlg = document.getElementById('dlg');
    const $dJob = document.getElementById('dlg-job');
    const $dArea = document.getElementById('dlg-area');
    const $dParent = document.getElementById('dlg-parent');
    const $dQual = document.getElementById('dlg-qual');
    const $dSalary = document.getElementById('dlg-salary');
    const $dlgX = document.getElementById('dlg-x');
    const $dlgClose = document.getElementById('dlg-close');

    const $openFilter = document.getElementById('btn-open-filter');
    const $dlgFilter = document.getElementById('dlg-filter');
    const $mfArea = document.getElementById('mf-area');
    const $mfParent = document.getElementById('mf-parent');
    const $mfApply = document.getElementById('mf-apply');
    const $mfClear = document.getElementById('mf-clear');
    const $mfClose = document.getElementById('mf-close');

    let rows = [];

    // ====== State Paging ======
    let page = 1;       // 1-based
    let pageSize = calcPageSize();
    let filtered = [];
    const SHOW_DBG = false;

    // ====== Util ======
    const collator = new Intl.Collator('id');
    const esc = s => String(s == null ? '' : s).replace(/[&<>"']/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
    const nl2br = s => String(s == null ? '' : s).replace(/\r?\n/g,'<br>');
    const norm = s => String(s == null ? '' : s).trim();
    const toKey = s => norm(s).toLowerCase();
    const uniqNorm = (arr) => { const map = new Map(); for(const v of arr){ const k = toKey(v); if(k && !map.has(k)) map.set(k, v); } return [...map.values()].sort((a,b)=>collator.compare(a,b)); };

    function setOptions(el, list, placeholder){ el.innerHTML = `<option value="">${placeholder}</option>` + list.map(v=>`<option value="${esc(v)}">${esc(v)}</option>`).join(''); }

    function looksLikeHeader(r0){
      const base = (r0||[]).map(x=>String(x||'').toLowerCase());
      const keys = ['area','nama job','job parent','kualifikasi','salary','gaji'];
      return keys.some(k => base.includes(k));
    }

    function stripHeader(arr){
      if(!arr || !arr.length) return arr || [];
      return looksLikeHeader(arr[0]) ? arr.slice(1) : arr;
    }

    function parseCSV(text){
      const out=[]; let row=[]; let cur=''; let inQ=false;
      for(let i=0;i<text.length;i++){
        const c=text[i];
        if(c==='"'){
          if(inQ && text[i+1]==='"'){ cur+='"'; i++; }
          else inQ=!inQ;
        } else if(c===',' && !inQ){
          row.push(cur); cur='';
        } else if((c==='\n' || c==='\r') && !inQ){
          if(c==='\r' && text[i+1]==='\n') i++;
          row.push(cur); out.push(row); row=[]; cur='';
        } else {
          cur+=c;
        }
      }
      if(cur.length>0 || row.length){ row.push(cur); out.push(row); }
      const cleaned = out.filter(r=> r.some(cell => (cell||'').trim().length));
      return stripHeader(cleaned);
    }

    function parseGVizJSON(txt){
      try{
        const json = JSON.parse(txt.slice(txt.indexOf('(')+1, txt.lastIndexOf(')')));
        const rs = (json.table && json.table.rows) ? json.table.rows : [];
        const arr = rs.map(r => (r.c||[]).map(c => c ? (c.f ?? c.v ?? '') : ''));
        return arr;
      } catch(e){
        return [];
      }
    }

    async function fetchWithTimeout(url, ms=15000){
      const ctrl = new AbortController(); const id = setTimeout(()=>ctrl.abort(), ms);
      try{
        const r = await fetch(url, {mode:'cors', cache:'no-cache', signal: ctrl.signal});
        if(!r.ok) throw new Error('HTTP '+r.status);
        return await r.text();
      } finally { clearTimeout(id); }
    }

    async function getData(){
      const order = [GVIZ_JSON, GVIZ_CSV, EXPORT_CSV, MIRROR(GVIZ_JSON), MIRROR(GVIZ_CSV), MIRROR(EXPORT_CSV)];
      let lastErr = '';
      for(const url of order){
        try{
          const text = await fetchWithTimeout(url);
          if(url.includes('out:json')){
            const arr = parseGVizJSON(text);
            if(arr && arr.length) return {rows: arr, source:url};
            lastErr = 'empty-json';
          } else if(url.includes('out:csv') || url.includes('export?format=csv')){
            const arr = parseCSV(text);
            if(arr && arr.length) return {rows: arr, source:url};
            lastErr = 'empty-csv';
          }
        }catch(e){ lastErr = e.message; }
      }
      throw new Error('Semua sumber gagal ('+ lastErr +'). Pastikan Sheet "'+SHEET+'" dibuka untuk siapa saja dengan tautan (Viewer).');
    }

    function updateParentOptions(){
      const areaVal = $area.value; const key = toKey(areaVal);
      const parents = uniqNorm(rows.filter(r => !areaVal || toKey(r[COL.AREA]) === key).map(r => r[COL.JOB_PARENT]||''));
      setOptions($parent, parents, 'Semua Job Parent');
    }

    function updateMobileParentOptions(){
      const areaVal = $mfArea.value || $area.value; const key = toKey(areaVal);
      const parents = uniqNorm(rows.filter(r => !areaVal || toKey(r[COL.AREA]) === key).map(r => r[COL.JOB_PARENT]||''));
      setOptions($mfParent, parents, 'Semua Job Parent');
    }

    function fillFilters(){
      const areas = uniqNorm(rows.map(r => r[COL.AREA]||''));
      setOptions($area, areas, 'Semua Area');
      updateParentOptions();
      // sinkron ke dialog mobile
      setOptions($mfArea, areas, 'Semua Area');
      updateMobileParentOptions();
    }

    // ====== ICONS by Job Parent ======
    const I = {
      briefcase: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9 4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2h3a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V8a2 2 0 0 1 2-2h3V4Zm2 0v2h2V4h-2Z"/></svg>',
      clipboard: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M8 3h8a2 2 0 0 1 2 2v1h-3.5a2.5 2.5 0 0 0-5 0H6V5a2 2 0 0 1 2-2Zm-2 5h12v11a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V8Z"/></svg>',
      sparkle: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 3l2.2 4.8L19 10l-4.8 2.2L12 17l-2.2-4.8L5 10l4.8-2.2L12 3Z"/></svg>',
      broom: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 17h14l-2 4H5l-2-4Zm9-10 7 7-2 2-7-7 2-2Zm3-3 2 2-1.5 1.5-2-2L15 4Z"/></svg>',
      coin: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><circle cx="12" cy="12" r="9"/><path d="M8 12h8M12 7v10" fill="none" stroke="currentColor" stroke-width="2"/></svg>',
      headset: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 3a8 8 0 0 0-8 8v5a3 3 0 0 0 3 3h1v-6H6v-2a6 6 0 1 1 12 0v2h-2v6h1a3 3 0 0 0 3-3v-5a8 8 0 0 0-8-8Z"/></svg>',
      chat: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 4h16v10H9l-5 4V4Z"/></svg>',
      wheel: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><circle cx="12" cy="12" r="9"/><circle cx="12" cy="12" r="3"/><path d="M12 3v6M21 12h-6M12 21v-6M3 12h6"/></svg>',
      code: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9 7 5 12l4 5M15 7l4 5-4 5"/></svg>',
      chef: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 10h10v3H7v-3Zm-1 3h12v5H6v-5Zm1-6a4 4 0 0 1 8 0h2a3 3 0 0 1 0 6H5a3 3 0 1 1 0-6h2Z"/></svg>',
      flask: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9 3h6v2h-1v5.1l4.8 7.7A2 2 0 0 1 17.2 20H6.8a2 2 0 0 1-1.6-3.2L10 10.1V5H9V3Z"/></svg>',
      scale: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 3l6 3-6 3-6-3 6-3Zm-6 5 4 7H2l4-7Zm12 0 4 7h-8l4-7Zm-6 7v6h-2v-6h2Z"/></svg>',
      factory: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 21V9l6 3V9l6 3V8l6 4v9H3Zm4-2h2v-3H7v3Zm5 0h2v-3h-2v3Z"/></svg>',
      megaphone: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 10h4l10-5v14l-10-5H7v3a2 2 0 0 0 2 2h2v2H9a4 4 0 0 1-4-4v-7Z"/></svg>',
      envelope: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 6h18v12H3V6Zm9 6L3 8v8h18V8l-9 4Z"/></svg>',
      checklist: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 4h18v2H3V4Zm0 5h8v2H3V9Zm0 5h8v2H3v-2Zm13-6 2 2 3-3-1.4-1.4L18 7.2l-1.6-1.6L15 7l1 1Z"/></svg>',
      mic: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M8 6a4 4 0 1 1 8 0v4a4 4 0 1 1-8 0V6Zm-1 6a5 5 0 0 0 10 0h2a7 7 0 0 1-6 6.9V21h-2v-2.1A7 7 0 0 1 5 12h2Z"/></svg>',
      tag: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 12V5h7l7 7-7 7-7-7Zm12-5a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/></svg>',
      shield: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2l8 3v6c0 5.5-3.5 9-8 11-4.5-2-8-5.5-8-11V5l8-3Z"/></svg>',
      badge: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2l2.4 4.9 5.4.8-3.9 3.8.9 5.5L12 14.9 7.2 17l.9-5.5L4.2 7.7l5.4-.8L12 2Z"/></svg>',
      wrench: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M14 2a6 6 0 0 0-6 6c0 .7.1 1.3.3 1.9L2 16.2 7.8 22l6.3-6.3c.6.2 1.2.3 1.9.3a6 6 0 0 0 0-12Z"/></svg>',
      checkBadge: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2l2.5 2H20v3l2 3-2 3v3h-5.5L12 22l-2.5-3H4v-3L2 10l2-3V4h5.5L12 2Zm-2 10 1.5 1.5L16 9l-1.4-1.4-3.1 3.1-1.1-1.1L9 11Z"/></svg>',
      box: '<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 7l9-4 9 4v10l-9 4-9-4V7Zm9 2-7-3v2l7 3 7-3V6l-7 3Z"/></svg>',
    };

    function iconFor(parentName){
      const k = toKey(parentName||'');
      let svg = I.briefcase; // default
      if(k.includes('back office')) svg = I.clipboard;
      else if(k.includes('beautician')) svg = I.sparkle;
      else if(k.includes('clean')) svg = I.broom;
      else if(k.includes('collection')) svg = I.coin;
      else if(k.includes('contact')) svg = I.headset;
      else if(k.includes('customer')) svg = I.chat;
      else if(k.includes('driver')) svg = I.wheel;
      else if(k === 'it' || k.includes('informat')) svg = I.code;
      else if(k.includes('kitchen')) svg = I.chef;
      else if(k.includes('laboran')) svg = I.flask;
      else if(k.includes('legal')) svg = I.scale;
      else if(k.includes('manufact')) svg = I.factory;
      else if(k.includes('market')) svg = I.megaphone;
      else if(k.includes('messenger')) svg = I.envelope;
      else if(k.includes('project')) svg = I.checklist;
      else if(k.includes('public')) svg = I.mic;
      else if(k.includes('sales')) svg = I.tag;
      else if(k.includes('security')) svg = I.shield;
      else if(k.includes('spv') || k.includes('supervis')) svg = I.badge;
      else if(k.includes('technician') || k.includes('teknisi')) svg = I.wrench;
      else if(k.includes('verifier') || k.includes('verifikasi')) svg = I.checkBadge;
      else if(k.includes('warehouse') || k.includes('gudang')) svg = I.box;
      else if(k.includes('administration') || k.includes('admin')) svg = I.briefcase;
      return `<span class="i" aria-hidden="true">${svg}</span>`;
    }

    function templateCard(r, idx){
      const job   = esc(r[COL.JOB_NAME]||'');
      const par   = esc(r[COL.JOB_PARENT]||'');
      const area  = esc(r[COL.AREA]||'-');
      const qual  = esc(r[COL.QUAL]||'');
      const sal   = esc(r[COL.SALARY]||'');
      const icon  = iconFor(par);
      return `
        <article class="card" data-i="${idx}" data-job="${job}" data-parent="${par}" data-area="${area}" data-qual="${qual}" data-salary="${sal}">
          <div class="job-title">${icon}<span>${job || '-'}</span></div>
          <div class="job-parent">${icon}<span>${par || '-'}</span></div>
          <div class="loc">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z"/></svg>
            <span>${area}</span>
          </div>
          <div class="sal">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 7h18a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1Zm3 2v6m12-6v6"/><circle cx="12" cy="12" r="2.5"/></svg>
            <span>${sal || '-'}</span>
          </div>
          <button class="show-more" type="button">Detail</button>
        </article>`;
    }

    function applyFilter(){
      const selArea   = $area.value;
      const selParent = $parent.value;
      const aKey = toKey(selArea);
      const pKey = toKey(selParent);
      filtered = rows.filter(r => {
        const rArea = toKey(r[COL.AREA]);
        const rParent = toKey(r[COL.JOB_PARENT]);
        const okA = aKey ? rArea === aKey : true;
        const okP = pKey ? rParent === pKey : true;
        return okA && okP;
      });
      page = 1; // reset ke halaman pertama
      renderPage();
    }

    function renderPage(){
      if(!filtered.length){
        $grid.hidden = true; $status.hidden = false; $pager.hidden = true; $status.textContent = 'Tidak ada data yang cocok dengan filter.'; $status.setAttribute('aria-busy','false');
        return;
      }

      pageSize = calcPageSize();
      const total = filtered.length;
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      page = Math.min(Math.max(1, page), totalPages);
      const start = (page-1)*pageSize;
      const end   = Math.min(start + pageSize, total);

      $status.hidden = true; $grid.hidden = false; $grid.innerHTML = '';
      const slice = filtered.slice(start, end);
      let html='';
      for(let i=0;i<slice.length;i++){ const r = slice[i]; html += templateCard(r, start + i); }
      $grid.insertAdjacentHTML('beforeend', html);

      // Pager
      $pager.hidden = false;
      $pgInfo.textContent = `Halaman ${page} dari ${totalPages} • ${total} job`;
      $pgPrev.disabled = page<=1; $pgNext.disabled = page>=totalPages;

      adjustMinHeight();
    }

    function calcPageSize(){
      const w = window.innerWidth;
      if(w >= 960) return 30;     // desktop
      if(w >= 640) return 20;     // tablet
      return 10;                  // mobile list
    }

    function adjustMinHeight(){
      // Supaya "fit with window": grid/status min-height = tinggi viewport - header - (filter visible?) - padding
      const headH = document.querySelector('header').getBoundingClientRect().height;
      let filterH = 0; const f = document.querySelector('.filters'); if(f && getComputedStyle(f).display!=='none') filterH = f.getBoundingClientRect().height + 12;
      const vh = window.innerHeight; const minH = Math.max(160, vh - headH - filterH - 32);
      $grid.style.minHeight = minH + 'px';
      $status.style.minHeight = minH + 'px';
    }

    function openModal({job,parent,area,qual,sal}){
      $dJob.textContent = job || '-';
      $dParent.textContent = parent ? `Job Parent: ${parent}` : '-';
      $dArea.textContent = area || '-';
      $dSalary.textContent = sal || '-';
      $dQual.innerHTML = nl2br(qual || '-');
      if(typeof $dlg.showModal === 'function') $dlg.showModal(); else $dlg.setAttribute('open','');
    }
    function closeModal(){ if($dlg.open) $dlg.close(); else $dlg.removeAttribute('open'); }

    // Delegasi click kartu -> buka modal
    document.addEventListener('click', e => {
      const btn = e.target.closest('.show-more');
      if(btn){
        const card = btn.closest('.card');
        const idx = Number(card.dataset.i);
        const r = filtered[idx] || [];
        openModal({ job: r[COL.JOB_NAME], parent: r[COL.JOB_PARENT], area: r[COL.AREA], qual: r[COL.QUAL], sal: r[COL.SALARY] });
      }
    });

    // Tombol close modal
    $dlgX.addEventListener('click', closeModal);
    $dlgClose.addEventListener('click', closeModal);

    // Filter desktop
    $btnApply.addEventListener('click', applyFilter);
    $btnClear.addEventListener('click', ()=>{ $area.value=''; updateParentOptions(); $parent.value=''; applyFilter(); });
    $area.addEventListener('change', ()=>{ updateParentOptions(); $parent.value=''; applyFilter(); });
    $parent.addEventListener('change', applyFilter);

    // Pager actions
    $pgPrev.addEventListener('click', ()=>{ page--; renderPage(); window.scrollTo({top:0,behavior:'smooth'}); });
    $pgNext.addEventListener('click', ()=>{ page++; renderPage(); window.scrollTo({top:0,behavior:'smooth'}); });

    // Filter Mobile (hamburger)
    $openFilter.addEventListener('click', ()=>{
      // sinkron nilai ke dialog
      $mfArea.value = $area.value || '';
      updateMobileParentOptions();
      $mfParent.value = $parent.value || '';
      if(typeof $dlgFilter.showModal === 'function') $dlgFilter.showModal(); else $dlgFilter.setAttribute('open','');
    });
    $mfArea.addEventListener('change', ()=>{ updateMobileParentOptions(); $mfParent.value=''; });
    $mfApply.addEventListener('click', ()=>{ $area.value = $mfArea.value; updateParentOptions(); $parent.value = $mfParent.value; applyFilter(); if($dlgFilter.open) $dlgFilter.close(); });
    $mfClear.addEventListener('click', ()=>{ $mfArea.value=''; updateMobileParentOptions(); $mfParent.value=''; });
    $mfClose.addEventListener('click', ()=>{ if($dlgFilter.open) $dlgFilter.close(); });

    // ====== Init ======
    (async function init(){
      // hitung sticky top (tinggi header)
      const head = document.querySelector('header');
      const updateSticky = ()=> document.documentElement.style.setProperty('--sticky-top', head.getBoundingClientRect().height + 'px');
      updateSticky();
      window.addEventListener('resize', ()=>{ updateSticky(); pageSize = calcPageSize(); renderPage(); adjustMinHeight(); });

      const dbg = document.getElementById('dbg');
      try{
        // Cache dulu kalau ada
        const cache = localStorage.getItem(CACHE_KEY);
        if(cache){
          const cached = JSON.parse(cache);
          if(Array.isArray(cached.rows) && cached.rows.length){
            rows = cached.rows;
            fillFilters();
            applyFilter();
            if(SHOW_DBG && dbg){ dbg.style.display='block'; dbg.textContent = `Cache: ${rows.length} baris`; }
          }
        }
        // Ambil data live
        const res = await getData();
        // buang header jika ada dari CSV pathway
        rows = stripHeader(res.rows || res) || [];
        // buang baris yang benar-benar kosong
        rows = rows.filter(r => (r && (r[COL.JOB_NAME]||'').toString().trim() || (r[COL.JOB_PARENT]||'').toString().trim() || (r[COL.AREA]||'').toString().trim()));

        localStorage.setItem(CACHE_KEY, JSON.stringify({rows}));
        fillFilters();
        applyFilter();
        $status.hidden = true; $grid.hidden = false; $status.setAttribute('aria-busy','false');
        if(SHOW_DBG && dbg){ dbg.style.display='block'; dbg.textContent = `Live: ${rows.length} baris` + (res.source? ` (src: ${res.source.includes('r.jina.ai')? 'mirror': res.source.includes('export?format=csv')? 'export-csv':'gviz'})`: ''); }
      }catch(err){
        console.error('[LOOKERIN] load fail', err);
        if(SHOW_DBG && dbg){ dbg.style.display='block'; dbg.textContent = 'ERR: '+ err.message; }
        if(!rows.length){ $status.textContent = 'Gagal memuat data: ' + err.message; $status.setAttribute('aria-busy','false'); }
      }
      adjustMinHeight();
    })();
  })();
  </script>
</body>
</html>
